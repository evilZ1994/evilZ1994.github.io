<!DOCTYPE html>
<html style="display: none;" lang="en">
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            SpringBoot编写RESTful API | 
        
        我的个人生活记录
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Zhu Yuexin">
    <meta name="description" itemprop="description" content="呀！发现一只会写代码的猪！">
    <meta name="keywords" content=",java,spring-boot,restful">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" sizes="192x192" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/favicon.ico">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="我的个人生活记录">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="SpringBoot编写RESTful API | 我的个人生活记录">
    <meta property="og:image" content="/img/favicon.ico">
    <meta property="og:description" content="呀！发现一只会写代码的猪！">
    <meta property="og:article:tag" content="java"> <meta property="og:article:tag" content="spring-boot"> <meta property="og:article:tag" content="restful"> 

    
        <meta property="article:published_time" content="Apr 29, 2019">
        <meta property="article:modified_time" content="May 05, 2019">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="SpringBoot编写RESTful API | 我的个人生活记录">
    <meta name="twitter:description" content="呀！发现一只会写代码的猪！">
    <meta name="twitter:image" content="/img/favicon.ico">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="http://yoursite.com">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2019/04/29/SpringBoot编写RESTful-API/index.html">
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "我的个人生活记录",
        "logo": "/img/favicon.ico"
    },
    "author": {
        "@type": "Person",
        "name": "Zhu Yuexin",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.ico"
        },
        "description": "The keyboard is typing on my fingertip,<br>The code is writing me,<br>My eyes are flashing in the cursor, and you are missing me."
    },
    "headline": "SpringBoot编写RESTful API",
    "url": "http://yoursite.com/2019/04/29/SpringBoot编写RESTful-API/index.html",
    "datePublished": "Apr 29, 2019",
    "dateModified": "May 05, 2019",
    "description": "呀！发现一只会写代码的猪！",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://yoursite.com"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    .footer-sns-facebook {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNjU3LjYgODcuOGw0LjggMy44djU1LjJjMCA1NC42IDAgNTUuMi00LjYgNTkuNi00LjQgNC40LTYgNC42LTUwLjIgNS42bC00NS42IDEtNy4yIDUuNmMtMTAuNCA4LTE2LjggMTcuMi0xOS4yIDI3LjQtMSA1LTEuOCAyNC44LTEuOCA0NCAuMiAzOCAxLjYgNDQuNiAxMC44IDQ4IDIuOCAxLjIgMjguNCAyIDU2LjggMiA0Ny44IDAgNTIgLjIgNTYuMiAzLjhsNC44IDMuOHY1NS4yYzAgNTQuNiAwIDU1LjItNC42IDU5LjYtNC40IDQuNi01LjQgNC42LTU3IDUuMi0yOC44LjItNTQuNC44LTU2LjggMS40LTIuNC42LTUuNiAzLTYuOCA1LjQtMS44IDMuMi0yLjQgNDEuNC0yLjYgMTQzLjJsLS4yIDEzOC44LTUuNiA0LjgtNS42IDQuOEg2MDljLTUyLjQgMC01Mi44IDAtNTguMi00LjZsLTUuNC00LjYtLjItMTQwLjYtLjItMTQwLjYtNC44LTMuOGMtNC4yLTMuNC04LTMuOC0zNS42LTMuOC0zMi44IDAtNDEtMS44LTQzLjYtMTAtLjYtMi4yLTEuMi0yNS40LTEuMi01MS40IDAtNjAuOC0uMi01NyAzLjQtNjEuNiAyLjgtMy42IDYtNCAzNy44LTUgMzMtMSAzNS4yLTEuMiAzOS40LTUuNiA0LjYtNC40IDQuNi01LjIgNS44LTcxIDEuMi03My40LjItNjcuMiAxNi42LTk5LjQgOC0xNS44IDEyLjgtMjIgMjgtMzcgMTUuMi0xNS4yIDIxLjQtMTkuNiAzOC4yLTI4IDExLTUuNCAyNC0xMSAyOS0xMi4yIDYuMi0xLjggMjguNi0yLjYgNzEuMi0yLjYgNTguNi0uMiA2Mi42IDAgNjcgMy42eiIvPjwvc3ZnPg==);
    }
    
    
    .footer-sns-twitter {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNTMyLjggMjA1YzEwIDQgMjMgMTAuOCAyOC44IDE1LjIgMTIuNiA5LjIgMTYuNiAxMC42IDI5LjQgOS40IDYuNi0uNiAxMy0zLjIgMjAuNC04LjIgMTEuMi03LjYgMTkuNC05LjIgMjMuNi01IDMuNiAzLjYgMi44IDktMi44IDE4LjYtNy4yIDEyLjQtNiAxOC44IDQuMiAyNC4yIDQuNCAyLjIgOC4yIDUuNiA4LjYgNy40IDEgNC44LTEyLjYgMjQuMi0yMiAzMS44LTExLjggOS4yLTE3LjIgMjIuNi0xOS42IDQ3LjgtNC44IDUwLjQtNy44IDY2LjYtMTYuNCA4NS40LTMgNy03IDE3LjgtOC44IDI0LTEuOCA2LjQtNSAxNC42LTcuNCAxOC40LTIuMiAzLjgtNy40IDEzLTExLjQgMjAuNC0xNy4yIDMwLjgtNDMuNCA2MS40LTcxLjQgODMuOC0yNS42IDIwLjQtNDYgMzMuMi02NC4yIDQwLjItOC40IDMuMi0xOCA3LjYtMjEuNCA5LjYtNy40IDQuNi0yMi40IDguNi01Ny4yIDE1LTYyLjIgMTEuNi03OS4yIDExLjQtMTM1LjYtMS0zMi40LTctMzguNi05LTUyLTE2LjgtMjEuNC0xMi42LTI0LjItMTQuOC0yNC4yLTE5LjQgMC02LjIgMTAuMi05LjIgMzUtMTAuNCAyMi40LTEgMjguNi0yLjYgNTctMTQuMiAyMy44LTkuOCAyOS40LTEyLjggMzAuNC0xNi44IDIuMi04LjItMy0xMy4yLTI2LjgtMjUuNC0yNS44LTEzLjItMzIuMi0xOC40LTQzLjgtMzUuOC05LTEzLjYtMTAtMjEuMi0zLjYtMzMuNiA1LjQtMTAuOCAzLjYtMTUtMTEuOC0yNS40LTktNi0xNC0xMS42LTIwLjgtMjIuNi0yMy40LTM3LjgtMjUtNTAuOC03LjItNTkuOCA0LjgtMi40IDkuNC01LjQgMTAuMi02LjYgMi44LTQuMi0uNC0xNS42LTguNC0yOS0xMS42LTE5LjYtMTMuMi0yNS44LTEzLjItNTUuMiAwLTI4LjggMi42LTM3LjggMTItNDAuMiA5LTIuMiAxNC44IDEgMzUuNiAyMC4yIDI0LjggMjIuOCA0My42IDM2LjYgNjIuOCA0NS44IDggMy44IDE3LjggOS4yIDIyIDEyIDQuMiAyLjggMTQuOCA3IDIzLjQgOS4yIDguNiAyLjIgMjQuMiA2LjggMzQuOCAxMC4yIDEzLjQgNC40IDIzLjYgNi40IDMzIDYuNiAxMi44LjIgMTQuMi0uMiAxOC42LTUuNCA0LTQuOCA0LjgtNy44IDQuOC0xOS4yIDAtMTQuNCA1LjYtMzkuNiAxMS4yLTUwLjYgNC4yLTguNCAyOS4yLTM0LjIgMzkuOC00MS40IDcuOC01LjQgMzUuNi0xNiA1Mi0yMCAxNC4yLTMuNiAzMi42LTEuMiA1Mi40IDYuOHoiLz48L3N2Zz4=);
    }
    
    
    .footer-sns-gplus {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHpNNDMwIDI5NS40YzQwLjYgMTUuNCA1Ni42IDIzLjggNzIuNiAzOC40IDYuOCA2LjIgNy4yIDE1LjIgMSAyMy40LTYuMiA4LTMzLjYgMzMuOC0zOSAzNi42LTUuNiAyLjgtMTcuNiAyLjgtMjMuMi0uMi0yLjQtMS4yLTguMi01LjItMTMtOC44LTExLjItOC42LTI0LjYtMTEuMi01NS4yLTExLjItMjcuNCAwLTQwLjYgMi42LTUyLjIgMTAuNC00LjQgMi44LTEyLjIgNy42LTE3LjIgMTAuNi0yMyAxMy4yLTUxLjQgNTUtNTUuOCA4Mi40LTIuNiAxNS42LTIuNCAzNC44LjIgNTEgMi44IDE3LjQgMTkuOCA0OC44IDM1LjIgNjUuMiAxNiAxNi42IDQ1IDMzLjYgNjIuOCAzNi42IDI2LjggNC40IDY1LjggMS42IDc5LjQtNS44IDIwLjYtMTEuNCAzMS0xOSA0MS0zMC40IDE4LjgtMjEuNiAyMy40LTM0LjIgMTUuNi00My44LTMuOC00LjgtNC40LTQuOC01MS01LjgtNjAuOC0xLjItNTYuMiAyLjItNTYuMi00My4yIDAtMzIuNC4yLTMzLjIgNC44LTM3IDQuNC0zLjYgOS0zLjggOTItMy44IDc5IDAgODcuOC40IDk0LjIgMy42IDExLjIgNS42IDEzIDExLjQgMTIuOCA0My40IDAgMjUuNC0uOCAzMC44LTcuNiA1OC00IDE2LjYtOS44IDM0LTEyLjYgMzktMi44IDUtOC4yIDE0LjItMTEuNiAyMC42LTguNCAxNS40LTI3LjIgMzYuOC00MC44IDQ2LjYtNS44IDQuNC0xMy44IDEwLjItMTcuNiAxMy4yLTMuOCAzLTExIDctMTYuMiA4LjgtNS4yIDEuOC0xNi4yIDYuNC0yNC40IDEwLTIyLjQgOS42LTM0LjggMTEuNi03MyAxMS42LTM3LjYuMi00Ny0xLjQtNzEtMTItOC4yLTMuNi0xNy42LTcuMi0yMC44LTgtMTUuOC0zLjgtNjctNDUuMi03Ny44LTYyLjgtMi4yLTMuOC03LjYtMTEuNi0xMS44LTE3LjItNC4yLTUuNC05LTE0LTEwLjYtMTktMS44LTQuOC02LjItMTYtMTAtMjQuOC0zLjYtOC44LTcuOC0yMi4yLTkuMi0yOS42LTMuMi0xOC44LTEuNC03OS40IDIuOC05MS40IDEzLjgtNDAuNiAzNS42LTc4IDU4LjgtMTAwLjIgMTQtMTMuNiA0Ny4yLTM2LjQgNTgtMzkuOCA0LjItMS40IDEzLjQtNS4yIDIwLjYtOC40IDIyLTEwIDMyLjgtMTEuNiA3Ni0xMSAzMy44LjYgNDAuNCAxLjIgNTAgNC44em0zNDAuOCA4MC44YzggMy42IDkuNiAxMS4yIDkuMiAzOS4yLS42IDM0LjQtLjYgMzQgNSAzOS42IDQuOCA1IDUuNCA1IDM3LjYgNSA0My40IDAgNDQuNC44IDQzLjIgMzYuMi0uOCAxNy0xLjIgMTguNC02LjQgMjMtNS40IDQuNi02LjYgNC44LTM3LjYgNC44LTMxLjIgMC0zMiAuMi0zNi44IDUtNS42IDUuNC01LjYgNC40LTUgNDEuMi40IDI2LjQuMiAyNy40LTQuNiAzMy00LjggNS42LTYgNS44LTI0LjQgNi40LTIwLjguOC0yOS42LTEuNC0zMy40LTguNC0xLjQtMi42LTItMTUuNi0xLjgtMzUuNi40LTMxLjIuNC0zMS42LTQuNi0zNi42cy01LjYtNS0zNi01Yy0xOC44IDAtMzMtLjgtMzYtMi4yLTcuNi0zLjYtOS42LTExLjItOC44LTMzLjguOC0yOC4yLjQtMjggNDEtMjggNDUuNCAwIDQ1LjQgMCA0NC42LTQyLjYtLjYtMzMtLjYtMzMgNS0zOC40IDQuNC00LjYgNi4yLTUgMjQuOC01IDExIDAgMjIuMiAxIDI1IDIuMnoiLz48L3N2Zz4=);
    }
    
    
    
    
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head -->
    
        
            <style>
  canvas {
    width: 100%;
    background: white;
    position: fixed;
    z-index: -1;
    
    }
  </style>
  <script>
    //var autoplay = getURLParameter('autoplay');
    var autoplay = true;
    var lastError = "";
    var playing = !!autoplay;
    function receiveMessage(event){
      var origin = event.origin || event.originalEvent.origin;
      console.log("Received message from " + origin);
      if(origin !== "http://dwitter.localhost:8000"
        && origin !== "http://localhost:8000"
        && origin !== "https://localhost:8000"
        && origin !== "https://www.dwitter.net"
        && origin !== "https://dwitter.net"){
          return;
        }
      console.log("Message was: " + event.data);

      switch (event.data) {
        case "toggle":
          playing ? pauseDemo() : playDemo();
          break;
        case "play":
          playDemo();
          break;
        case "pause":
          pauseDemo();
          break;
        case "showStats":
          setStatsVisibility(true);
          break;
        case "hideStats":
          setStatsVisibility(false);
          break;
      }

      if(event.data.substring(0, 4) == "code"){
        var code = event.data.substring(5,event.data.length);
        newCode(code);
      }
    }

    function displayError(e) {
      if(lastError != e){
        lastError = e;
        parent.postMessage({
          'type': 'error',
          'error': ""+e,
          'location': window.location.href
        },"*");
      }
    }

    function newCode(code) {
        try {
          eval("u = function(t){"+code+"\n};");
        } catch (e) {
          u = function(t){
            throw e;
          };
          throw e;
        }
        displayError("");
        reset();
    }

    function pauseDemo(){
      if(!playing){
        return;
      }

      pauseTime = +new Date();

      playing = false;
    }

    function playDemo(){
      if(playing){
        return
      }

      playing = true;
      requestAnimationFrame(loop);
    }
    var timeOffset = 0;

    window.addEventListener("message", receiveMessage, false);

    function getURLParameter(name) {
      return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
    }

    function setStatsVisibility(visible) {
      document.getElementById('stats').style.visibility = visible ? 'visible' : 'hidden';
    }
  </script>
  
  
  <script type="text/javascript">
    (function(f,e){"object"===typeof exports&&"undefined"!==typeof module?module.exports=e():"function"===typeof define&&define.amd?define(e):f.Stats=e()})(this,function(){var f=function(){function e(a){c.appendChild(a.dom);return a}function u(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;right:0;opacity:0.9;z-index:10000";var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));u(0);return{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function(){k=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();h.update(c-k,200);if(c>g+1E3&&(r.update(1E3*a/(c-g),100),g=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){k=this.end()},domElement:c,setMode:u}};f.Panel=function(e,f,l){var c=Infinity,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r;q.height=h;q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");b.font="bold "+9*a+"px Helvetica,Arial,sans-serif";b.textBaseline="top";b.fillStyle=l;b.fillRect(0,0,r,h);b.fillStyle=f;b.fillText(e,t,v);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(h,w){c=Math.min(c,h);k=Math.max(k,h);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=f;b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,g((1-h/w)*p))}}};return f});
  </script>

        
            <canvas id="c" width="2000" height="1080"></canvas>
<script>
  function createStats() {
    var stats = new Stats();
    stats.showPanel(0);
    stats.dom.setAttribute('id', 'stats');
    document.body.appendChild(stats.dom);
    return stats;
  }

  var stats = createStats();
  setStatsVisibility(false);

  var c = document.querySelector("#c");
  c.width = 1920;
  c.height = 1080;
  var S = Math.sin;
  var C = Math.cos;
  var T = Math.tan;
  function R(r,g,b,a) {
    a = a === undefined ? 1 : a;
    return "rgba("+(r|0)+","+(g|0)+","+(b|0)+","+a+")";
    };
  var x = c.getContext("2d");
  var time = 0;
  var frame = 0;
  function u(t) {
     x.fillRect(0,0,i=w=c.width=2e3,w);
     x.fillStyle="#FFFFFF";
     x.fillRect(0,0,w,w);
     x.fillStyle="#03A9F4";
     for(;i--;)T=t*99,z=w*99/(i-T%1),a=i+T-T%1,x.fillRect(C(a*a)*z+1e3,C(a*w)*z+500,w/i,w/i)

     /*x.fillStyle="#FFFFFF";
      x.fillRect(0,0,2e3,2e3);
      x.fillStyle="#03A9F4";
      x.font="20px Comic Sans MS";
      for(i=100;i--;){
        Z=130-(t*10+i)%130;
        s=280/Z;
        var str_index=i%7;
        var love_words;
        switch(str_index) {
          case 0:
            love_words="I ♥ 皮皮夏";
            break;
          case 1:
            love_words="Do you love me ?"
            break;
          case 2:
            love_words="I love you";
            break;
          case 3:
            love_words="You are so pretty !";
            break;
          case 4:
            love_words="I ♥ you";
            break;
          case 5:
            love_words="Love You Forever";
            break;
          case 6:
            love_words="♥";
            break;
          default:
            love_words="♥";
        }
        x.fillText(love_words,960+1/Z*(-99+i*6e72%199)*700,540+(-70+i*8e61%140)/Z*700);
      }*/
    }
  function loop() {
    stats = stats || createStats();

    if (playing){
      requestAnimationFrame(loop);
    }
    time = frame/60;
    if(time * 60 | 0 == frame - 1){
      time += 0.000001;
    }
    frame++;

    try {
      stats.begin();
      u(time);
      stats.end();
      displayError("");
    } catch (e) {
      displayError(e);
      throw e;
    }
  }
  if(autoplay) {
      loop();
  }

  function reset(){
    c = document.querySelector("#c");
    c.width = 1920;
    c.height = 1080;
    S = Math.sin;
    C = Math.cos;
    T = Math.tan;
    R = function(r,g,b,a) {
      a = a === undefined ? 1 : a;
      return "rgba("+(r|0)+","+(g|0)+","+(b|0)+","+a+")";
    };
    x = c.getContext("2d");
    time = 0;
    frame = 0;
  }
  </script>

        
    
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#RESTful-API"><span class="post-toc-number">1.</span> <span class="post-toc-text">RESTful API</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#RESTful-API-URI示例"><span class="post-toc-number">2.</span> <span class="post-toc-text">RESTful API URI示例</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#示例程序"><span class="post-toc-number">3.</span> <span class="post-toc-text">示例程序</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建SpringBoot项目"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">创建SpringBoot项目</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建实体类"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">创建实体类</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建Controller"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">创建Controller</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置日志"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">配置日志</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在项目中使用日志"><span class="post-toc-number">3.4.1.</span> <span class="post-toc-text">在项目中使用日志</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringBoot热部署"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">SpringBoot热部署</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#利用CURL命令或者PostMan工具进行调试"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">利用CURL命令或者PostMan工具进行调试</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实现tvseries的API"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">实现tvseries的API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#根据id获取某个电视剧的信息"><span class="post-toc-number">3.7.1.</span> <span class="post-toc-text">根据id获取某个电视剧的信息</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新增一个电视剧"><span class="post-toc-number">3.7.2.</span> <span class="post-toc-text">新增一个电视剧</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#根据id修改一个电视剧的信息"><span class="post-toc-number">3.7.3.</span> <span class="post-toc-text">根据id修改一个电视剧的信息</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#根据id删除一个电视剧"><span class="post-toc-number">3.7.4.</span> <span class="post-toc-text">根据id删除一个电视剧</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件上传示例"><span class="post-toc-number">3.7.5.</span> <span class="post-toc-text">文件上传示例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件下载示例"><span class="post-toc-number">3.7.6.</span> <span class="post-toc-text">文件下载示例</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#在RestController中获取各种相关信息的方法"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">在RestController中获取各种相关信息的方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#对客户端传入的数据进行校验"><span class="post-toc-number">3.9.</span> <span class="post-toc-text">对客户端传入的数据进行校验</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JSR303"><span class="post-toc-number">3.9.1.</span> <span class="post-toc-text">JSR303</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Bean-Validation注解"><span class="post-toc-number">3.9.2.</span> <span class="post-toc-text">Bean Validation注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#代码示例"><span class="post-toc-number">3.9.3.</span> <span class="post-toc-text">代码示例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#进阶"><span class="post-toc-number">3.9.4.</span> <span class="post-toc-text">进阶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#复杂验证情况"><span class="post-toc-number">3.9.4.1.</span> <span class="post-toc-text">复杂验证情况</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Bean-Validation-2-0-中的约束用注解"><span class="post-toc-number">3.9.5.</span> <span class="post-toc-text">Bean Validation 2.0 中的约束用注解</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#后端程序的逻辑层次"><span class="post-toc-number">4.</span> <span class="post-toc-text">后端程序的逻辑层次</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#数据对象"><span class="post-toc-number">5.</span> <span class="post-toc-text">数据对象</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#整合Mybatis"><span class="post-toc-number">6.</span> <span class="post-toc-text">整合Mybatis</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本步骤"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">基本步骤</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#准备数据库"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">准备数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建层次结构"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">创建层次结构</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dao层"><span class="post-toc-number">6.3.1.</span> <span class="post-toc-text">Dao层</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Service层"><span class="post-toc-number">6.3.2.</span> <span class="post-toc-text">Service层</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Controller层"><span class="post-toc-number">6.3.3.</span> <span class="post-toc-text">Controller层</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#其他"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">其他</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#单元测试"><span class="post-toc-number">7.</span> <span class="post-toc-text">单元测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JUnit"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">JUnit</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#mockito"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">mockito</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#测试业务逻辑层"><span class="post-toc-number">7.2.1.</span> <span class="post-toc-text">测试业务逻辑层</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#测试web控制层"><span class="post-toc-number">7.2.2.</span> <span class="post-toc-text">测试web控制层</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#SpringBoot事务Transactional"><span class="post-toc-number">8.</span> <span class="post-toc-text">SpringBoot事务Transactional</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#propagation参数"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">propagation参数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#isolation参数"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">isolation参数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#几种数据异常"><span class="post-toc-number">8.2.1.</span> <span class="post-toc-text">几种数据异常</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#几种隔离级别的比较"><span class="post-toc-number">8.2.2.</span> <span class="post-toc-text">几种隔离级别的比较</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#锁与隔离的区别"><span class="post-toc-number">8.2.3.</span> <span class="post-toc-text">锁与隔离的区别</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#示例"><span class="post-toc-number">8.2.4.</span> <span class="post-toc-text">示例</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#timeout参数"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">timeout参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Spring-Security"><span class="post-toc-number">9.</span> <span class="post-toc-text">Spring Security</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注解"><span class="post-toc-number">9.1.1.</span> <span class="post-toc-text">注解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#常用表达式"><span class="post-toc-number">9.1.2.</span> <span class="post-toc-text">常用表达式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Controller中获取当前用户"><span class="post-toc-number">9.1.3.</span> <span class="post-toc-text">Controller中获取当前用户</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#示例-1"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">示例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置-1"><span class="post-toc-number">9.2.1.</span> <span class="post-toc-text">配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Token管理"><span class="post-toc-number">9.2.2.</span> <span class="post-toc-text">Token管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#TokenService-java"><span class="post-toc-number">9.2.2.1.</span> <span class="post-toc-text">TokenService.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#TokenController-java"><span class="post-toc-number">9.2.2.2.</span> <span class="post-toc-text">TokenController.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AuthenticationTokenFilter-java"><span class="post-toc-number">9.2.2.3.</span> <span class="post-toc-text">AuthenticationTokenFilter.java</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#示例-2"><span class="post-toc-number">9.2.3.</span> <span class="post-toc-text">示例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SampleService-java"><span class="post-toc-number">9.2.3.1.</span> <span class="post-toc-text">SampleService.java</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SampleController-java"><span class="post-toc-number">9.2.3.2.</span> <span class="post-toc-text">SampleController.java</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OAuth2-0"><span class="post-toc-number">9.3.</span> <span class="post-toc-text">OAuth2.0</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#授权码模式"><span class="post-toc-number">9.3.1.</span> <span class="post-toc-text">授权码模式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JWT"><span class="post-toc-number">9.3.2.</span> <span class="post-toc-text">JWT</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Spring异步-Async"><span class="post-toc-number">10.</span> <span class="post-toc-text">Spring异步 @Async</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Spring-Scheduling-定时任务"><span class="post-toc-number">11.</span> <span class="post-toc-text">Spring Scheduling 定时任务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参数"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#缓存"><span class="post-toc-number">12.</span> <span class="post-toc-text">缓存</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Spring-Cache"><span class="post-toc-number">12.1.</span> <span class="post-toc-text">Spring Cache</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#key"><span class="post-toc-number">12.1.1.</span> <span class="post-toc-text">key</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CacheEvict"><span class="post-toc-number">12.1.2.</span> <span class="post-toc-text">@CacheEvict</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#示例-3"><span class="post-toc-number">12.1.3.</span> <span class="post-toc-text">示例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置过期"><span class="post-toc-number">12.1.4.</span> <span class="post-toc-text">设置过期</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Redis"><span class="post-toc-number">12.2.</span> <span class="post-toc-text">Redis</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Autowired加载规则"><span class="post-toc-number">13.</span> <span class="post-toc-text">@Autowired加载规则</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#定制Spring-Rest的错误返回信息"><span class="post-toc-number">14.</span> <span class="post-toc-text">定制Spring Rest的错误返回信息</span></a></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                SpringBoot编写RESTful API
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.gif" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Zhu Yuexin</strong>
        <span>Apr 29, 2019</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/java/">java</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/restful/">restful</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/spring-boot/">spring-boot</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=SpringBoot编写RESTful API&url=http://yoursite.com/2019/04/29/SpringBoot编写RESTful-API/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=SpringBoot编写RESTful API&url=http://yoursite.com/2019/04/29/SpringBoot编写RESTful-API/index.html&via=Zhu Yuexin" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2019/04/29/SpringBoot编写RESTful-API/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com/2019/04/29/SpringBoot编写RESTful-API/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>网易云课堂<a href="https://study.163.com/course/courseMain.htm?courseId=1005213034" target="_blank" rel="noopener">《用Spring Boot编写RESTful API》</a>学习笔记</p>
<p><a href="https://github.com/gexiangdong/tutorial" target="_blank" rel="noopener">https://github.com/gexiangdong/tutorial</a></p>
<p><a href="https://github.com/evilZ1994/SpringBootRestDemo" target="_blank" rel="noopener">https://github.com/evilZ1994/SpringBootRestDemo</a></p>
</blockquote>
<h1 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h1><ul>
<li><strong>REST</strong>是<strong>Representational State Transfer</strong>的缩写</li>
<li>所有的东西都是<strong>资源</strong>，所有的操作都通过对资源的增删改查（CRUD）实现</li>
<li>对资源的增删改查对应于URL的操作（<strong>POST</strong>, <strong>DELETE</strong>, <strong>PUT</strong>, <strong>GET</strong>）</li>
<li>无状态</li>
</ul>
<blockquote>
<p>无状态：客户端到服务器的每个请求都必须包含理解请求所需的所有信息，并且不能利用服务器上存储的任何上下文。因此，会话状态完全保留在客户端上。</p>
</blockquote>
<p>无状态意味着不能使用Session在服务器端存储登陆状态等信息。（可以使用<a href="https://jwt.io/" target="_blank" rel="noopener">JWT</a>做无状态的身份认证）</p>
<h1 id="RESTful-API-URI示例"><a href="#RESTful-API-URI示例" class="headerlink" title="RESTful API URI示例"></a>RESTful API URI示例</h1><p>以一个对电视剧列表的管理作为示例：</p>
<p>URL：<strong><a href="http://somehost/tvseries" target="_blank" rel="noopener">http://somehost/tvseries</a></strong></p>
<ul>
<li>GET /tvseries    获取电视剧列表</li>
<li>POST /tvseries    创建一个新电视剧</li>
<li>GET /tvseries/101    获取编号为101的电视剧信息</li>
<li>PUT /tvseries/101    修改编号为101的电视剧信息</li>
<li>DELETE /tvseries/101    删除编号为101的电视剧</li>
<li>GET /tvseries/101/characters    获取编号为101的电视剧的人物列表</li>
</ul>
<blockquote>
<p>URI命名：</p>
<ul>
<li>/资源名称</li>
<li>/资源名称/{资源ID}</li>
<li>/资源名称/{资源ID}/子资源名称</li>
<li>/资源名称/{资源ID}/子资源名称/{子资源ID}</li>
</ul>
</blockquote>
<h1 id="示例程序"><a href="#示例程序" class="headerlink" title="示例程序"></a>示例程序</h1><h2 id="创建SpringBoot项目"><a href="#创建SpringBoot项目" class="headerlink" title="创建SpringBoot项目"></a>创建SpringBoot项目</h2><p>选择依赖时，勾选<strong>Rest Repositories</strong>，其他依赖根据自己需要勾选</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429155300.png" alt></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429155400.png" alt></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429155500.png" alt></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429155600.png" alt></p>
<h2 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h2><p>TvSeriesDto.java:</p>
<pre class=" language-lang-java"><code class="language-lang-java">package com.example.rest;

import com.fasterxml.jackson.annotation.JsonFormat;

import java.util.Date;

public class TvSeriesDto {
    private Integer id;
    private String name;
    private int seasonCount;  // 总共多少季
    private List<TvCharacterDto> tvCharacters;  // 角色表
    // 设置日期格式化为Json格式
    @JsonFormat(timezone = "GMT+8", pattern = "yyyy-MM-dd")
    private Date originRelease;  // 发行日期

    public TvSeriesDto(){
    }

    public TvSeriesDto(int id, String name, int seasonCount, Date originRelease) {
        this.id = id;
        this.name = name;
        this.seasonCount = seasonCount;
        this.originRelease = originRelease;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getSeasonCount() {
        return seasonCount;
    }

    public void setSeasonCount(int seasonCount) {
        this.seasonCount = seasonCount;
    }

    public Date getOriginRelease() {
        return originRelease;
    }

    public void setOriginRelease(Date originRelease) {
        this.originRelease = originRelease;
    }

      public List<TvCharacterDto> getTvCharacters() {
        return tvCharacters;
    }

    public void setTvCharacters(List<TvCharacterDto> tvCharacters) {
        this.tvCharacters = tvCharacters;
    }

    @Override
    public String toString() {
        return "TvSeriesDto{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", seasonCount=" + seasonCount +
                ", originRelease=" + originRelease +
                '}';
    }
}
</code></pre>
<p>这里配置了日期的Json格式化，除了注解方式，还可以在配置文件中配置。这里我们采用<code>.yml</code>配置，将<code>application.properties</code>修改为<code>application.yml</code>，然后配置日期的Json格式化：</p>
<pre class=" language-lang-yaml"><code class="language-lang-yaml">spring:
  jackson:
    date-format: yyyy-MM-dd  #如果使用字符串型表示，用这行设置格式
    timezone: GMT+8
    serialization:
      write-dates-as-timestamps: true  #使用数值时间戳表示日期
</code></pre>
<p>如果两种配置方式同时使用的话，注解优先。</p>
<p>TvCharacterDto.java:</p>
<pre class=" language-lang-java"><code class="language-lang-java">public class TvCharacterDto {
    private Integer id;
    private int tvSeriesId;
    private String name;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public int getTvSeriesId() {
        return tvSeriesId;
    }

    public void setTvSeriesId(int tvSeriesId) {
        this.tvSeriesId = tvSeriesId;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
</code></pre>
<h2 id="创建Controller"><a href="#创建Controller" class="headerlink" title="创建Controller"></a>创建Controller</h2><p>TvSeriesController.java:</p>
<pre class=" language-lang-java"><code class="language-lang-java">@RestController
@RequestMapping("/tvseries")
public class TvSeriesController {

    @GetMapping
    public List<TvSeriesDto> getAll() {
        // 示例：http://localhost:8080/tvseries
        List<TvSeriesDto> list = new ArrayList<>();
        list.add(createWestWorld());
        list.add(createPoi());
        return list;
    }

      // 两个辅助方法，产生两个电视剧实例
    private TvSeriesDto createPoi() {
        Calendar c = Calendar.getInstance();
        c.set(2011, Calendar.SEPTEMBER, 22, 0, 0);
        return new TvSeriesDto(102, "Person of Interest", 5, c.getTime());
    }
    private TvSeriesDto createWestWorld() {
        Calendar c = Calendar.getInstance();
        c.set(2016, Calendar.OCTOBER, 2, 0, 0);
        return new TvSeriesDto(101, "West World", 1, c.getTime());
    }
}
</code></pre>
<p>然后启动SpringBoot，在浏览器地址输入：<a href="http://localhost:8080/tvseries，可以看到返回的Json数据：" target="_blank" rel="noopener">http://localhost:8080/tvseries，可以看到返回的Json数据：</a></p>
<pre class=" language-lang-json"><code class="language-lang-json">[{"id":101,"name":"West World","seasonCount":1,"originRelease":"2016-10-02"},{"id":102,"name":"Person of Interest","seasonCount":5,"originRelease":"2011-09-22"}]
</code></pre>
<h2 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a>配置日志</h2><p>在<code>application.yml</code>中加入：</p>
<pre class=" language-lang-yaml"><code class="language-lang-yaml">logging:
  file: target/app.log
  level:
    ROOT: WARN
    com.example: TRACE
</code></pre>
<p>其中<strong>file</strong>是日志的保存位置，<strong>level</strong>用于配置日志的级别。</p>
<p>日志级别：<strong>TARCE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</strong></p>
<p>如果日志级别设置为<strong>INFO</strong>，那么级别低于<strong>INFO</strong>的（<strong>TRACE, DEBUG</strong>）都不会输出。</p>
<p><strong>ROOT</strong>表示项目的所有日志级别。我们还可以配置指定包下的日志级别，比如<strong>com.example</strong></p>
<h3 id="在项目中使用日志"><a href="#在项目中使用日志" class="headerlink" title="在项目中使用日志"></a>在项目中使用日志</h3><pre class=" language-lang-java"><code class="language-lang-java">import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

@RestController
@RequestMapping("/tvseries")
public class TvSeriesController {
    // 日志
    private static final Log log = LogFactory.getLog(TvSeriesController.class);

    @GetMapping
    public List<TvSeriesDto> getAll() {
        // 示例：http://localhost:8080/tvseries
        if (log.isTraceEnabled()) {
            log.trace("getAll()被调用了");
        }
        List<TvSeriesDto> list = new ArrayList<>();
        list.add(createWestWorld());
        list.add(createPoi());
        return list;
    }
}
</code></pre>
<h2 id="SpringBoot热部署"><a href="#SpringBoot热部署" class="headerlink" title="SpringBoot热部署"></a>SpringBoot热部署</h2><p>首先在pom.xml中加入devtools:</p>
<pre class=" language-lang-xml"><code class="language-lang-xml"><dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-devtools</artifactId>
</dependency>
</code></pre>
<p>然后在Idea中打开自动编译</p>
<p><img src="http://upyun.nidhogg.cn/img/Idea20190423211200.png" alt="http://upyun.nidhogg.cn/img/Idea20190423211200.png"></p>
<p>使用快捷键Command+Shift+A，查找Registry，找到并勾选<strong>compiler.automake.allow.when.app.running</strong></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429193500.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429193500.png"></p>
<h2 id="利用CURL命令或者PostMan工具进行调试"><a href="#利用CURL命令或者PostMan工具进行调试" class="headerlink" title="利用CURL命令或者PostMan工具进行调试"></a>利用CURL命令或者PostMan工具进行调试</h2><p><strong>CURL</strong>：<a href="http://blog.ishavanti.top/2019/04/23/命令行工具CURL/" target="_blank" rel="noopener">http://blog.ishavanti.top/2019/04/23/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7CURL/</a></p>
<p>PostMan：<a href="https://www.getpostman.com/" target="_blank" rel="noopener">https://www.getpostman.com/</a></p>
<h2 id="实现tvseries的API"><a href="#实现tvseries的API" class="headerlink" title="实现tvseries的API"></a>实现tvseries的API</h2><h3 id="根据id获取某个电视剧的信息"><a href="#根据id获取某个电视剧的信息" class="headerlink" title="根据id获取某个电视剧的信息"></a>根据id获取某个电视剧的信息</h3><p><strong>GET /tvseries/{id}</strong></p>
<pre class=" language-lang-java"><code class="language-lang-java">@GetMapping("/{id}")
public TvSeriesDto getOne(@PathVariable int id) {
    // 示例：http://localhost:8080/tvseries/101
    if (log.isTraceEnabled()) {
          log.trace("getOne " + id);
    }
    // TODO: 查找数据库
    if (id == 101) {
          return createWestWorld();
    } else if (id == 102) {
          return createPoi();
    } else {
          throw new ResourceNotFoundException();
    }
}
</code></pre>
<h3 id="新增一个电视剧"><a href="#新增一个电视剧" class="headerlink" title="新增一个电视剧"></a>新增一个电视剧</h3><p><strong>POST /tvseries</strong></p>
<pre class=" language-lang-java"><code class="language-lang-java">@PostMapping
public TvSeriesDto insertOne(@RequestBody TvSeriesDto tvSeriesDto) {
  // Post请求
    if (log.isTraceEnabled()) {
          log.trace("这里应该写新增到数据库的代码，传递进来的参数是：" + tvSeriesDto);
    }
    tvSeriesDto.setId(9999);
    return tvSeriesDto;
}
</code></pre>
<h3 id="根据id修改一个电视剧的信息"><a href="#根据id修改一个电视剧的信息" class="headerlink" title="根据id修改一个电视剧的信息"></a>根据id修改一个电视剧的信息</h3><p><strong>PUT /tvseries/{id}</strong></p>
<pre class=" language-lang-java"><code class="language-lang-java">@PutMapping("/{id}")
public TvSeriesDto updateOne(@PathVariable int id, @RequestBody TvSeriesDto tvSeriesDto) {
    if (log.isTraceEnabled()) {
        log.trace("updateOne " + tvSeriesDto);
    }
    if (id == 101 || id == 102) {
        //TODO: 根据tvSeriesDto的内容更新数据库，更新后返回新内容
        return createPoi();
    } else {
        throw new ResourceNotFoundException();
    }
}
</code></pre>
<h3 id="根据id删除一个电视剧"><a href="#根据id删除一个电视剧" class="headerlink" title="根据id删除一个电视剧"></a>根据id删除一个电视剧</h3><p><strong>DELETE /tvseries/{id}</strong></p>
<pre class=" language-lang-java"><code class="language-lang-java">@DeleteMapping("/{id}")
public Map<String, String> deleteOne(@PathVariable int id, HttpServletRequest request, @RequestParam(value = "delete_reason", required = false)String deleteReason) throws Exception {
    if (log.isTraceEnabled()) {
        log.trace("deleteOne " + id);
    }
    Map<String, String> result = new HashMap<>();
    if (id == 101) {
        //TODO: 执行删除代码
        result.put("message", "#101被" + request.getRemoteAddr() + "删除（原因：" + deleteReason + ")");
    } else if (id == 102) {
        throw new RuntimeException("#102不能被删除");
    } else {
        throw new ResourceNotFoundException();
    }
    return result;
}
</code></pre>
<h3 id="文件上传示例"><a href="#文件上传示例" class="headerlink" title="文件上传示例"></a>文件上传示例</h3><p><strong>POST /tvseries/{id}/photos</strong></p>
<pre class=" language-lang-java"><code class="language-lang-java">import org.apache.commons.io.IOUtils;

...

@PostMapping(value = "/{id}/photos", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
public void addPhoto(@PathVariable int id, @RequestParam("photo")MultipartFile imgFile) throws IOException {
    if (log.isTraceEnabled()) {
        log.trace("接收到文件 " + id + ", 收到文件： " + imgFile.getOriginalFilename());
    }
    // 保存文件
    FileOutputStream fos = new FileOutputStream("target/" + imgFile.getOriginalFilename());
    IOUtils.copy(imgFile.getInputStream(), fos);
    fos.close();
}
</code></pre>
<p>注意<code>consumes = MediaType.MULTIPART_FORM_DATA_VALUE</code></p>
<p>IOUtils需要引入<code>commons-io</code>依赖：</p>
<p>pom.xml</p>
<pre class=" language-lang-xml"><code class="language-lang-xml"><dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.6</version>
</dependency>
</code></pre>
<h3 id="文件下载示例"><a href="#文件下载示例" class="headerlink" title="文件下载示例"></a>文件下载示例</h3><p><strong>GET /tvseries/{id}/icon</strong></p>
<pre class=" language-lang-java"><code class="language-lang-java">@GetMapping(value = "/{id}/icon", produces = MediaType.IMAGE_JPEG_VALUE)
public byte[] getIcon(@PathVariable int id) throws Exception {
    if (log.isTraceEnabled()) {
        log.trace("getIcon(" + id + ")");
    }
    String iconFile = "target/test.jpg";
    InputStream is = new FileInputStream(iconFile);
    return IOUtils.toByteArray(is);
}
</code></pre>
<p>注意：<code>produces = MediaType.IMAGE_JPEG_VALUE</code></p>
<p>返回byte数组。</p>
<h2 id="在RestController中获取各种相关信息的方法"><a href="#在RestController中获取各种相关信息的方法" class="headerlink" title="在RestController中获取各种相关信息的方法"></a>在RestController中获取各种相关信息的方法</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429171500.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429171500.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429171600.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429171600.png"></p>
<h2 id="对客户端传入的数据进行校验"><a href="#对客户端传入的数据进行校验" class="headerlink" title="对客户端传入的数据进行校验"></a>对客户端传入的数据进行校验</h2><h3 id="JSR303"><a href="#JSR303" class="headerlink" title="JSR303"></a>JSR303</h3><p>JSR是java的一个规范，JSR303是对JavaBean进行验证的规范（Bean Validation）</p>
<blockquote>
<p>JSR303只是一个规范，没有具体的实现</p>
<p>Hibernate Validator是对JSR303的一个实现</p>
</blockquote>
<h3 id="Bean-Validation注解"><a href="#Bean-Validation注解" class="headerlink" title="Bean Validation注解"></a>Bean Validation注解</h3><p>常用注解：</p>
<ul>
<li>@Null    验证对象是否为空</li>
<li>@NotNull    验证对象是否为非空</li>
<li>@Min    验证Number和String对象是否大于等于指定的值</li>
<li>@Max    验证Number和String对象是否小于等于指定的值</li>
<li>@Size    验证对象（Array, Collection, Map, String）长度是否在给定的范围之内</li>
<li>@Past    验证Date和Calendar对象是否在当前时间之前</li>
<li>@Future    验证Date和Calendar对象是否在当前时间之后</li>
<li>@AssertTrue    验证Boolean对象是否为True</li>
<li>@AssertFalse    验证Boolean对象是否为False</li>
<li>@Valid    级联验证注解</li>
</ul>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>TvSeriesDto.java:</p>
<pre class=" language-lang-java"><code class="language-lang-java">public class TvSeriesDto {
    @Null private Integer id;  // 表示客户端可以不传id，id必须为空
    @NotNull private String name;  // 表示客户端必须传名称
    @DecimalMin("1") private int seasonCount;  // 总共多少季
    @Valid @NotNull @Size(min = 2)  // @Valid表示要级联校验；@Size(min = 2)表示这个列表至少要有2项内容，否则不通过校验
    private List<TvCharacterDto> tvCharacters;
    // 设置日期格式化为Json格式
    @JsonFormat(timezone = "GMT+8", pattern = "yyyy-MM-dd")
    // @Past表示只接受过去的时间，比当前时间晚的被认为不合格
    @Past private Date originRelease;  // 发行日期
}
</code></pre>
<p>TvCharacterDto.java:</p>
<pre class=" language-lang-java"><code class="language-lang-java">public class TvCharacterDto {
    private Integer id;
    private int tvSeriesId;
    @NotNull private String name;
}
</code></pre>
<p>最重要的是在Controller函数中，要对需要验证的参数使用<code>@Valid</code>注解开启验证：</p>
<pre class=" language-lang-java"><code class="language-lang-java">/**
 * @Valid 注解表示需要验证传入的参数TvSeriesDto，需要验证的field在TvSeriesDto内通过注解定义
 * @param tvSeriesDto
 * @return
 */
@PostMapping
public TvSeriesDto insertOne(@Valid @RequestBody TvSeriesDto tvSeriesDto) {
  // Post请求
  if (log.isTraceEnabled()) {
    log.trace("这里应该写新增到数据库的代码，传递进来的参数是：" + tvSeriesDto);
  }
  tvSeriesDto.setId(9999);
  return tvSeriesDto;
}
</code></pre>
<p>用PostMan测试</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429201400.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429201400.png"></p>
<p>出现两个错误：</p>
<ul>
<li>Field error in object ‘tvSeriesDto’ on field ‘id’: rejected value [0];…;default message [必须为null]</li>
</ul>
<p>原因是TvSeriesDto类中，我把id设置为int类型，又加上了@Null注解，而int类型默认值为0，不会为空，所以无法通过验证。应该把int类型改为<strong>Integer</strong>类型：</p>
<pre class=" language-lang-java"><code class="language-lang-java">@Null private Integer id;  // id必须为空
</code></pre>
<ul>
<li>Field error in object ‘tvSeriesDto’ on field ‘tvCharacters’: rejected value [null];…;default message [不能为null]</li>
</ul>
<p>原因是TvSeriesDto类中的字段tvCharacters忘了写<strong>getter</strong>和<strong>setter</strong>方法 - -!!!</p>
<blockquote>
<p>前面的代码已纠正</p>
</blockquote>
<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429204100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429204100.png"></p>
<p>注解的位置：</p>
<ul>
<li>Field level    成员变量</li>
<li>Property level    get(is) 方法上</li>
<li>Class level    类上</li>
</ul>
<p>示例：</p>
<pre class=" language-lang-java"><code class="language-lang-java">// images不可为null；每个元素(Image类型)需要级联验证
@NotNull
private List<@Valid Image> images;
</code></pre>
<pre class=" language-lang-java"><code class="language-lang-java">// images长度至少为1，不可为null；每个元素（String类型）不可为null，最短长度为10
@NotNull
@Size(min = 1)
private List<@Size(min = 10) @NotNull String> images;
</code></pre>
<blockquote>
<p>约束规则对子类有效</p>
</blockquote>
<h4 id="复杂验证情况"><a href="#复杂验证情况" class="headerlink" title="复杂验证情况"></a>复杂验证情况</h4><p><strong>groups参数</strong>：</p>
<ul>
<li>每个约束用注解都有一个groups参数</li>
<li>可接收多个class类型（必须是接口）</li>
<li>不声明groups参数是默认组javax.validation.groups.Default</li>
<li>声明了groups参数的会从Default组移除，如需加入Default组需要显示声明，例如<code>@Null(groups={Default.class, Step1.class})</code></li>
</ul>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429205900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429205900.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429210900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429210900.png"></p>
<p><strong>手动验证</strong></p>
<p>在Controller层，使用了@Validated注解，Spring会自动完成校验工作。但是有时在其他地方也需要进行校验，比如在Service层，就需要手动进行验证。</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429211300.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429211300.png"></p>
<h3 id="Bean-Validation-2-0-中的约束用注解"><a href="#Bean-Validation-2-0-中的约束用注解" class="headerlink" title="Bean Validation 2.0 中的约束用注解"></a>Bean Validation 2.0 中的约束用注解</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429211800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429211800.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190429211900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190429211900.png"></p>
<h1 id="后端程序的逻辑层次"><a href="#后端程序的逻辑层次" class="headerlink" title="后端程序的逻辑层次"></a>后端程序的逻辑层次</h1><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503095100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503095100.png"></p>
<h1 id="数据对象"><a href="#数据对象" class="headerlink" title="数据对象"></a>数据对象</h1><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503095800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503095800.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503100100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503100100.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503100700.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503100700.png"></p>
<h1 id="整合Mybatis"><a href="#整合Mybatis" class="headerlink" title="整合Mybatis"></a>整合Mybatis</h1><h2 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h2><ul>
<li>修改pom.xml，添加Mybatis支持</li>
</ul>
<pre class=" language-lang-xml"><code class="language-lang-xml"><dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.0.1</version>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>
</code></pre>
<ul>
<li>修改application.yml，添加数据库连接</li>
</ul>
<pre class=" language-lang-yaml"><code class="language-lang-yaml">spring:
  datasource:
    dbcp2:
      validation-query: select 1
#    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/rest
    username: root
    password: ******
mybatis:
  configuration:
    map-underscore-to-camel-case: true
</code></pre>
<p><code>map-underscore-to-camel-case: true</code>是为了实现驼峰命名的转换</p>
<p><code>driver-class-name: com.mysql.jdbc.Driver</code>不需要手动导入：The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.</p>
<ul>
<li>修改启动类，增加@MapperScan(“package-of-mapping”)注解</li>
</ul>
<pre class=" language-lang-java"><code class="language-lang-java">@SpringBootApplication
@MapperScan("com.example.rest.mybatis.dao")
public class RestApplication {
    public static void main(String[] args) {
        SpringApplication.run(RestApplication.class, args);
    }
}
</code></pre>
<ul>
<li>添加Mybatis Mapping接口</li>
<li>添加Mapping对应的XML（可选）</li>
</ul>
<h2 id="准备数据库"><a href="#准备数据库" class="headerlink" title="准备数据库"></a>准备数据库</h2><p>创建数据库：</p>
<pre class=" language-lang-mysql"><code class="language-lang-mysql">create database if not exists rest default charset utf8mb4 collate utf8mb4_unicode_ci;
</code></pre>
<p>创建数据表：</p>
<pre class=" language-lang-mysql"><code class="language-lang-mysql">create table tv_series(
id INT NOT NULL AUTO_INCREMENT,
name VARCHAR(100) NOT NULL,
season_count INT NOT NULL,
origin_release DATE,
delete_reason VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre>
<p>插入一条数据：</p>
<pre class=" language-lang-mysql"><code class="language-lang-mysql">insert into tv_series(name, season_count, origin_release) values ('西部世界', 1, '2016/10/02');
</code></pre>
<h2 id="创建层次结构"><a href="#创建层次结构" class="headerlink" title="创建层次结构"></a>创建层次结构</h2><p>还是以电视剧列表管理作为例子。首先新建一个<code>pojo</code>目录，直接将之前的<code>TvSeriesDto.java</code>和<code>TvCharacter.java</code>拷贝过来重命名后作为我们的POJO。</p>
<h3 id="Dao层"><a href="#Dao层" class="headerlink" title="Dao层"></a>Dao层</h3><p>新建<code>dao</code>目录：</p>
<p>TvSeriesDao.java</p>
<pre class=" language-lang-java"><code class="language-lang-java">@Repository
public interface TvSeriesDao {
    @Select("select * from tv_series")
    List<TvSeries> getAll();
}
</code></pre>
<p>这里的查询语句是直接写在注解里的，如果查询比较复杂的话可以写在XML文件中</p>
<h3 id="Service层"><a href="#Service层" class="headerlink" title="Service层"></a>Service层</h3><p>新建<code>service</code>目录：</p>
<p>TvSeriesService.java</p>
<pre class=" language-lang-java"><code class="language-lang-java">@Service
public class TvSeriesService {
    @Autowired
    TvSeriesDao tvSeriesDao;

    public List<TvSeries> getAllTvSeries() {
        return tvSeriesDao.getAll();
    }
}
</code></pre>
<h3 id="Controller层"><a href="#Controller层" class="headerlink" title="Controller层"></a>Controller层</h3><p>新建<code>controller</code>目录，把之前的<code>TvSeriesController</code>拷贝过来（之前的controller需要把注解删掉或者注释掉，否则两个controller会冲突），修改数据操作逻辑：</p>
<pre class=" language-lang-java"><code class="language-lang-java">@RestController
@RequestMapping("/tvseries")
public class TvSeriesController {
    // 日志
    private static final Log log = LogFactory.getLog(TvSeriesController.class);

    @Autowired
    TvSeriesService tvSeriesService;

    @GetMapping
    public List<TvSeries> getAll() {
        // 示例：http://localhost:8080/tvseries
        if (log.isTraceEnabled()) {
            log.trace("getAll()被调用了");
        }
        List<TvSeries> list = tvSeriesService.getAllTvSeries();
        if (log.isTraceEnabled()) {
            log.trace("查询到" + list.size() + "条记录");
        }
        return list;
    }
}
</code></pre>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>MyBatis可以用<strong>TypeHandler</strong>处理枚举、数组和JSON类型</p>
<h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="JUnit"><a href="#JUnit" class="headerlink" title="JUnit"></a>JUnit</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503112700.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503112700.png"></p>
<h2 id="mockito"><a href="#mockito" class="headerlink" title="mockito"></a>mockito</h2><p>pom.xml</p>
<pre class=" language-lang-xml"><code class="language-lang-xml"><dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-core</artifactId>
    <scope>test</scope>
</dependency>
</code></pre>
<p>mockito是Java中使用最广泛的mock框架，mock就是创建一个虚假的类对象，在测试环境中替换掉真实对象。使用mockito可以避免测试时与数据库的依赖。</p>
<h3 id="测试业务逻辑层"><a href="#测试业务逻辑层" class="headerlink" title="测试业务逻辑层"></a>测试业务逻辑层</h3><p>TvSeriesServiceTests.java</p>
<pre class=" language-lang-java"><code class="language-lang-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class TvSeriesServiceTests {

    @MockBean
    TvSeriesDao tvSeriesDao;
    @Autowired
    TvSeriesService tvSeriesService;

    @Test
    public void testGetAllWithMockito() {
        List<TvSeries> list = tvSeriesService.getAllTvSeries();
        // 这里的测试结果依赖连接数据库内的记录，很难写一个判断是否成功的条件，甚至无法执行
        // 下面的testGetAll()方法，使用了mock出来的dao作为桩模块，避免了这一情形
        Assert.assertTrue(list.size() >= 0);
    }

    @Test
    public void testGetAll() {
        // 设置一个TvSeries list
        List<TvSeries> list = new ArrayList<>();
        TvSeries ts = new TvSeries();
        ts.setName("POI");
        list.add(ts);

        // 下面这个语句是告诉mock出来的tvSeriesDao当执行getAll方法时，返回上面创建的list
        Mockito.when(tvSeriesDao.getAll()).thenReturn(list);

        // 测试tvSeriesService的getAllTvSeries()方法，获得返回值
        List<TvSeries> result = tvSeriesService.getAllTvSeries();

        // 判断返回值是否和最初做的那个list相同，应该是相同的
        Assert.assertTrue(result.size() == list.size());
        Assert.assertTrue("POI".equals(result.get(0).getName()));
    }

    @Test
    public void testGetOne() {
        // 根据不同的传入参数，被mock的bean返回不同的数据的例子
        String newName = "Person of Interest";
        BitSet mockExecuted = new BitSet();
        Mockito.doAnswer(new Answer() {
            @Override
            public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
                Object[] args = invocationOnMock.getArguments();
                TvSeries bean = (TvSeries)args[0];
                // 传入的值，应该和下面调用tvSeriesService.updateTvSeries()方法时的参数中的值相同
                Assert.assertEquals(newName, bean.getName());
                mockExecuted.set(0);
                return 1;
            }
        });

        TvSeries ts = new TvSeries();
        ts.setName(newName);
        ts.setId(111);

        tvSeriesService.updateTvSeries(ts);
        Assert.assertTrue(mockExecuted.get(0));
    }
}
</code></pre>
<h3 id="测试web控制层"><a href="#测试web控制层" class="headerlink" title="测试web控制层"></a>测试web控制层</h3><p>AppTests.java</p>
<pre class=" language-lang-java"><code class="language-lang-java">@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class AppTests {

    /**
     * @MockBean 可给当前的spring context装载一个假的bean上去替代原有的同名bean
     * mock了dao的所有bean后，数据访问层就别接管了，从而实现测试不受具体数据库内数据值影响的效果
     */
    @MockBean
    TvSeriesDao tvSeriesDao;
    @MockBean
    TvCharacterDao tvCharacterDao;

    @Autowired
    MockMvc mockMvc;

    @Autowired
    private TvSeriesController tvSeriesController;

    @Test
    public void testGetAll() throws Exception {
        List<TvSeries> list = new ArrayList<>();
        TvSeries ts = new TvSeries();
        ts.setName("POI");
        list.add(ts);

        Mockito.when(tvSeriesDao.getAll()).thenReturn(list);

        // 下面这个是相当于在启动项目后，执行 GET /tvseries , 被测模块是web控制层，因为web控制层会调用业务逻辑层，所以业务逻辑层也会被测试
        // 业务逻辑层调用了被mock出来的数据访问层桩模块
        // 如果想仅仅测试web控制层，（例如业务逻辑层尚未编码完毕），可以mock一个业务逻辑层的桩模块
            mockMvc.perform(MockMvcRequestBuilders.get("/tvseries")).andDo(MockMvcResultHandlers.print()).andExpect(MockMvcResultMatchers.status().isOk()).andExpect(MockMvcResultMatchers.content().string(Matchers.containsString("POI")));
        // 上面这几句和字面意思一致，期望状态是200，返回值包含POI三个字母，桩模块返回的一个电视剧名字是POI，如果测试正确是包含这三个字母的。
    }
}
</code></pre>
<h1 id="SpringBoot事务Transactional"><a href="#SpringBoot事务Transactional" class="headerlink" title="SpringBoot事务Transactional"></a>SpringBoot事务Transactional</h1><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503154700.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503154700.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503155200.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503155200.png"></p>
<h2 id="propagation参数"><a href="#propagation参数" class="headerlink" title="propagation参数"></a>propagation参数</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503154800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503154800.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503154900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503154900.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503155000.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503155000.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503155100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503155100.png"></p>
<h2 id="isolation参数"><a href="#isolation参数" class="headerlink" title="isolation参数"></a>isolation参数</h2><p>事务隔离</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503160600.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503160600.png"></p>
<h3 id="几种数据异常"><a href="#几种数据异常" class="headerlink" title="几种数据异常"></a>几种数据异常</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503160700.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503160700.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503160800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503160800.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503160900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503160900.png"></p>
<h3 id="几种隔离级别的比较"><a href="#几种隔离级别的比较" class="headerlink" title="几种隔离级别的比较"></a>几种隔离级别的比较</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503161000.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503161000.png"></p>
<h3 id="锁与隔离的区别"><a href="#锁与隔离的区别" class="headerlink" title="锁与隔离的区别"></a>锁与隔离的区别</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503161100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503161100.png"></p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503161200.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503161200.png"></p>
<h2 id="timeout参数"><a href="#timeout参数" class="headerlink" title="timeout参数"></a>timeout参数</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503161300.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503161300.png"></p>
<p>默认值-1表示永远不会超时</p>
<h1 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h1><p>依赖：</p>
<pre class=" language-lang-xml"><code class="language-lang-xml"><dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-security</artifactId>
</dependency>
</code></pre>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503170300.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503170300.png"></p>
<ol>
<li>关闭<strong>Session</strong></li>
<li>所有请求都要通过授权验证</li>
<li>访问以<strong>“/manager”</strong>开始的url都必须具备<strong>admin</strong>这个角色</li>
<li>其他的url都可以直接访问</li>
</ol>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503170400.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503170400.png"></p>
<ul>
<li>prePostEnabled: 控制蓝色区域的注解是否可用</li>
<li>securedEnabled: 控制黄色区域的注解是否可用</li>
<li>jsr250Enabled: 控制绿色区域的注解是否可用</li>
</ul>
<p><strong>Pre Post:</strong></p>
<ul>
<li>@PreAuthorize: 在方法执行前，验证PreAuthorize里面的Spring表达式，True则继续执行，False则返回403</li>
<li>@PostAuthorize: 在方法执行后，验证方法执行的结果是否满足表达式，True则继续，False返回403</li>
<li>@PreFilter: 在方法执行前对传入参数进行过滤</li>
<li>@PostFilter: 在方法执行后对返回结果进行过滤</li>
</ul>
<h3 id="常用表达式"><a href="#常用表达式" class="headerlink" title="常用表达式"></a>常用表达式</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503171800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503171800.png"></p>
<ul>
<li>hasRole: 同时具有参数中设置的角色</li>
<li>hasAnyRole: 具有参数中任意一个角色即可</li>
<li>hasAuthority: 同时具有参数中的权限</li>
<li>hasAnyAuthority: 具有任意一个权限</li>
<li>permitAll: 所有的都允许</li>
<li>denyAll: 所有都不允许</li>
</ul>
<p><strong>角色和权限的区别</strong></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503171900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503171900.png"></p>
<h3 id="Controller中获取当前用户"><a href="#Controller中获取当前用户" class="headerlink" title="Controller中获取当前用户"></a>Controller中获取当前用户</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503172000.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503172000.png"></p>
<p>在其他地方，比如Service层，可以用上图最后一条语句获取当前用户</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><p>加入Spring Security的依赖后，访问<code>http://localhost:8080/tvseries</code>就会自动跳转到<code>http://localhost:8080/login</code></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503172100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503172100.png"></p>
<p>然后在控制台我们可以看到Spring Security自动生成了密码：</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503172200.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503172200.png"></p>
<p>我们输入用户名<strong>user</strong>，和控制台生成的密码就可以通过验证，查看到返回结果</p>
<blockquote>
<p>需要注意的是，需要将之前的日志配置中，ROOT的日志级别设置为<strong>INFO</strong>，才能看到生成的密码</p>
</blockquote>
<p>如果要实现更复杂的验证，就需要对Spring Security进行配置</p>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>WebSecurityConfig.java</p>
<pre class=" language-lang-java"><code class="language-lang-java">@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true, jsr250Enabled = false)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
    private final static Log log = LogFactory.getLog(WebSecurityConfig.class);

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        if (log.isTraceEnabled()) {
            log.trace("configure httpSecurity ...");
        }

        // 默认的spring-security配置会让所有的请求都必须在已登陆的情况下访问；下面这段代码禁止了这种操作
        http.csrf().disable().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS).and()
                .authorizeRequests().anyRequest().permitAll();
    }
}
</code></pre>
<h3 id="Token管理"><a href="#Token管理" class="headerlink" title="Token管理"></a>Token管理</h3><h4 id="TokenService-java"><a href="#TokenService-java" class="headerlink" title="TokenService.java"></a>TokenService.java</h4><p>对Token的生成，查询和存储</p>
<pre class=" language-lang-java"><code class="language-lang-java">@Service
public class TokenService {
    // 一般是把token和用户对应关系放在数据库或高速缓存(例如readis/memcache等），放在一个单例类的成员变量里仅适合很小规模的情形
    private Map<String, UserDetails> tokenMap = new HashMap<>();

    /**
     * 登陆，成功返回token
     * @param username
     * @param password
     * @return
     */
    public String login(String username, String password) {
        UserDetails ud = null;
        // 此例中支持三个用户： author/reader/admin 三个用户的密码都是password; author具有author角色；reader具有reader角色；admin则2个角色都有
        if ("author".equals(username) && "password".equals(password)) {
            ud = createUser(username, password, new String[] {"author"});
        } else if ("reader".equals(username) && "password".equals(password)) {
            ud = createUser(username, password, new String[] {"reader"});
        } else if ("admin".equals(username) && "password".equals(password)){
            ud = createUser(username, password, new String[]{"author", "reader"});
        }
        if (ud != null) {
            String token = UUID.randomUUID().toString();
            tokenMap.put(token, ud);
            return token;
        } else {
            return null;
        }
    }

    /**
     * 退出，移除token
     * @param token
     */
    public void Logout(String token) {
        tokenMap.remove(token);
    }

    /**
     * 这个方法在每次访问都会被调用；为了提示效率应该使用@Cacheable注解缓存
     * @param token
     * @return
     */
    public UserDetails getUserFromToken(String token) {
        if (token == null) {
            return null;
        }
        return tokenMap.get(token);
    }

    private UserDetails createUser(String username, String password, String[] roles) {
        return new UserDetails() {
            @Override
            public Collection<? extends GrantedAuthority> getAuthorities() {
                Collection<GrantedAuthority> authorities = new ArrayList<>();

                //这是增加了一种名为query的权限，可以使用 @hasAuthority("query") 来判断
                SimpleGrantedAuthority authority = new SimpleGrantedAuthority("query");
                authorities.add(authority);

                //这是增加xxx角色，可以用hasRole("xxx")来判断；需要注意所有的角色在这里增加时必须以ROLE_前缀，使用时则没有ROLES_前缀
                for (String role : roles) {
                    SimpleGrantedAuthority sga = new SimpleGrantedAuthority("ROLES_" + role);
                    authorities.add(sga);
                }

                return authorities;
            }

            @Override
            public String getPassword() {
                return password;
            }

            @Override
            public String getUsername() {
                return username;
            }

            @Override
            public boolean isAccountNonExpired() {
                return true;
            }

            @Override
            public boolean isAccountNonLocked() {
                return true;
            }

            @Override
            public boolean isCredentialsNonExpired() {
                return true;
            }

            @Override
            public boolean isEnabled() {
                return true;
            }
        };
    }
}
</code></pre>
<h4 id="TokenController-java"><a href="#TokenController-java" class="headerlink" title="TokenController.java"></a>TokenController.java</h4><pre class=" language-lang-java"><code class="language-lang-java">@RestController
@RequestMapping("/token")
public class TokenController {
    private final static Log log = LogFactory.getLog(TokenController.class);

    @Autowired
    TokenService tokenService;

    @PostMapping
    public ResponseEntity<Map<String, Object>> login(@RequestBody Map<String, String> userInfo) {
        String userName = userInfo.get("username");
        String password = userInfo.get("password");

        HashMap<String, Object> result = new HashMap<>();
        String token = tokenService.login(userName, password);
        if (token == null) {
            result.put("message", "invalid username or password");
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(result);
        } else {
            result.put("token", token);
            return ResponseEntity.status(HttpStatus.OK).body(result);
        }
    }
}
</code></pre>
<h4 id="AuthenticationTokenFilter-java"><a href="#AuthenticationTokenFilter-java" class="headerlink" title="AuthenticationTokenFilter.java"></a>AuthenticationTokenFilter.java</h4><p>对请求过滤时，将Token对应的用户信息取出放置到Spring上下文中</p>
<pre class=" language-lang-java"><code class="language-lang-java">/**
 * 从request中获取token，并把token转换成用户，放置到当前的spring context内
 * 这个类必须写一个@Service注解，否则Spring不会把它加载作为filter
 */
@Service
public class AuthenticationTokenFilter extends OncePerRequestFilter {
    private final static Log log = LogFactory.getLog(AuthenticationTokenFilter.class);
    @Autowired
    TokenService tokenService;

    @Override
    protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException {
        String authToken = null;

        // 下面的代码从Http Header的Authorization中获取token，也可以从其他header, cookie等中获取，看客户端怎么传递token
        String requestHeader = httpServletRequest.getHeader("Authorization");
        if (requestHeader != null && requestHeader.startsWith("bearer")) {
            authToken = requestHeader.substring(7);
        }
        if (log.isTraceEnabled()) {
            log.trace("token is " + authToken);
        }
        if (authToken != null) {
            UserDetails user = null;
            user = tokenService.getUserFromToken(authToken);
            if (user != null) {
                // 把user设置到SecurityContextHolder内，以便Spring使用
                UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());
                authenticationToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(httpServletRequest));
                SecurityContextHolder.getContext().setAuthentication(authenticationToken);
            }
        }
        filterChain.doFilter(httpServletRequest, httpServletResponse);
    }
}
</code></pre>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><h4 id="SampleService-java"><a href="#SampleService-java" class="headerlink" title="SampleService.java"></a>SampleService.java</h4><pre class=" language-lang-java"><code class="language-lang-java">@Service
public class SampleService {
    private final static Log log = LogFactory.getLog(SampleService.class);

    /**
     * PreAuthorize/PostAuthorize注解也可以写在Service的public方法上
     */
    @PreAuthorize("#id % 2 == 0")
    //  @PostAuthorize("returnObject.get('id') <= 10")
    public Map<String, Object> getOneById(int id) {
        if (log.isTraceEnabled()) {
            log.trace("getOneById: " + id);
        }
        HashMap<String, Object> map = new HashMap<>();
        map.put("id", id);
        return map;
    }
}
</code></pre>
<h4 id="SampleController-java"><a href="#SampleController-java" class="headerlink" title="SampleController.java"></a>SampleController.java</h4><pre class=" language-lang-java"><code class="language-lang-java">@RestController
@RequestMapping("/")
public class SampleController {
    private final static Log log = LogFactory.getLog(SampleController.class);

    @Autowired
    SampleService sampleService;

    /**
     * 使用注解@PreAuthorize来保护方法只能被特定用户组的用户访问
     * 测试时：
     * curl http://localhost:8080/ 会返回403禁止访问
     * curl -H "Authorization: Bearer xxxx" http://localhost:8080/ 则会正常返回内容，得到一个长度为2的JSON数组（xxxx是token）
     * @return
     */
    @GetMapping
    @PreAuthorize("hasRole('author')")
    public List<Map<String, Object>> getAll() {
        if (log.isTraceEnabled()) {
            log.trace("getAll()");
        }
        List<Map<String, Object>> list = new ArrayList<>();
        HashMap<String, Object> m1 = new HashMap<>();
        m1.put("id", 101);
        m1.put("name", "jack");
        list.add(m1);

        HashMap<String, Object> m2 = new HashMap<>();
        m2.put("id", 102);
        m2.put("name", "Dolores");
        list.add(m2);

        return list;
    }

    /**
     * 通过参数 Authentication auth 在程序中获取当前的用户。
     * 测试时可使用 #curl http://localhost:8080/{id}，得到的数据中没有author字段。
     * #curl -H "Authorization: Bearer xxxx" http://localhost:8080/{id} 得到的数据中有authro字段，值是当前token对应的用户名
     */
    @GetMapping("/{id}")
    public Map<String, Object> getOne(@PathVariable int id, Authentication authentication) {
        if (log.isTraceEnabled()) {
            log.trace("getOne: " + id);
        }
        HashMap<String, Object> map = new HashMap<>();
        map.put("id", id);
        map.put("name", (id == 101 ? "Waytt" : (id == 102 ? "Dolores" : "unknow")));
        if (authentication != null) {
            // 获取当前用户 （这里的auth即 AuthenticationTokenFilter中设置的 UsernamePasswordAuthenticationToken line: 51)
            // UserDetail是 AuthenticationTokenFilter line: 48行的UserDetails
            UserDetails userDetails = (UserDetails) authentication.getPrincipal();
            map.put("author", userDetails.getUsername());
        }
        return map;
    }

    @PutMapping("/{id}")
    // @PreAuthorize("map.get('id') == 10")
    //  @PostAuthorize("returnObject.get('id') == 10")
    public Map<String, Object> updateOne(@PathVariable int id, @RequestBody Map<String, Object> map) {
        Map<String, Object> result = sampleService.getOneById(id);
        map.remove("id");
        result.putAll(map);
        return result;
    }

    /**
     * PreFilter/PostFilter这2个注解的作用是过滤参数/返回值的；PreFilter会按照注解参数设定，只保留符合规则的参数传给方法；
     * PostFilter则把方法返回值再次过滤，只保留符合规则的返回给客户端。
     * 例如下面的例子，PreFilter会过滤掉客户端传递过来的参数中所有不以a开头的字符串；而PostFilter则过滤掉返回数据中所有不以b结尾的字符串。
     * 执行时，客户端传递的字符串数组，只有以a开头的会被打印，并且只有以a开头并以b结尾的字符串才可以被返回给客户端；
     * PreFilter/PostFilter也和PreAuthorize/PostAuthorize一样必须用@EnableGlobalMethodSecurity(prePostEnabled = true打开才能用。
     */
    @PostMapping("/children")
    @PreFilter(filterTarget = "list", value = "filterObject.startsWith('a')")
    @PostFilter("filterObject.startsWith('b')")
    public List<String> echo(@RequestBody List<String> list) {
        if(log.isTraceEnabled()) {
            log.trace("echo ... list.size()= " + list.size());
            for(String s : list) {
                log.trace("  " + s );
            }
        }
        return list;
    }
}
</code></pre>
<h2 id="OAuth2-0"><a href="#OAuth2-0" class="headerlink" title="OAuth2.0"></a>OAuth2.0</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503204800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503204800.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503204900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503204900.png"></p>
<p>OAuth2.0有四种授权模式，其中<strong>授权码模式、密码模式</strong>比较常用，<strong>简化模式、客户端模式</strong>较少使用。</p>
<p><strong>Refresh Token</strong>不是OAuth的授权模式，但是在SpringBoot中可以设置，用来在Token到期前刷新Token，得到有效期更长的Token。</p>
<h3 id="授权码模式"><a href="#授权码模式" class="headerlink" title="授权码模式"></a>授权码模式</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503210000.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503210000.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503210100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503210100.png"></p>
<p>服务器和浏览器之间通过token进行交互，但是服务器并不知道token对应的是谁，如果需要知道对应的用户信息，则需要向OAuth服务器进行查询。</p>
<p>将token与用户关系存入缓存可以缓解这种问题，但是OAuth端可以随时让token失效，缓存中无法即时更新token。</p>
<p>另外的解决办法就是跳过向OAuth服务器查询的步骤，让token自己证明自己。<strong>JWT</strong>就是这样一种token。</p>
<h3 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190503211200.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190503211200.png"></p>
<p>注意<strong>Playload</strong>部分没有加密，不要存放敏感信息。</p>
<p>依赖：</p>
<pre class=" language-lang-xml"><code class="language-lang-xml"><dependency>
    <groupId>com.auth0</groupId>
  <artifactId>java-jwt</artifactId>
  <version>3.3.0</version>
</dependency>
</code></pre>
<blockquote>
<p><a href="https://github.com/auth0/java-jwt" target="_blank" rel="noopener">https://github.com/auth0/java-jwt</a></p>
</blockquote>
<h1 id="Spring异步-Async"><a href="#Spring异步-Async" class="headerlink" title="Spring异步 @Async"></a>Spring异步 @Async</h1><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505161800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505161800.png"></p>
<p>@EnableAsync注解只能加在有@SpringBootApplication或@Configuration注解的类上，其他类上无作用。</p>
<p>@EnableAsync启用异步后，在方法中加上@Async注解后就可以异步执行了。</p>
<p>只有从<strong>外部调用</strong>才能异步执行：</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505162700.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505162700.png"></p>
<ul>
<li><strong>1</strong>是异步执行的</li>
<li><strong>2</strong>不是异步执行的，因为<code>doC</code>方法没有@Async注解</li>
<li><strong>3，4</strong>不是异步执行的，因为不是从外部调用</li>
</ul>
<p>@Async注解的方法的返回值：</p>
<ul>
<li>void</li>
<li>Future\<t\></t\></li>
<li>其他类型一律返回null；遇到int/double/float/boolean基本类型，执行时会抛出异常：AopInvocationException</li>
</ul>
<h1 id="Spring-Scheduling-定时任务"><a href="#Spring-Scheduling-定时任务" class="headerlink" title="Spring Scheduling 定时任务"></a>Spring Scheduling 定时任务</h1><ul>
<li>@EnableScheduling 注解启用Scheduling（@SpringBootApplication类或者@Configuration类上）</li>
<li>方法上加@Scheduled注解，方法会按照参数定期执行</li>
</ul>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505163900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505163900.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505164000.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505164000.png"></p>
<p><strong>,</strong>  : 用于设置多个非连续值，比如在小时处使用 <strong>6, 8, 12</strong> 就表示6点，8点，12点三个时间点</p>
<p><strong>-</strong>  : 用于设置连续的区间，比如在小时处使用 <strong>6-12</strong> 就表示6点到12点期间</p>
<p><strong>*</strong>  : 表示任意</p>
<p><strong>?</strong>  : 只能写在日和星期几，当日期和星期几冲突时，表示任意</p>
<p><strong>/</strong>  : 用来指定数值的增量，比如在子表达式（分钟）里的<strong>“0/15”</strong>表示从第0分钟开始，每15分钟</p>
<p><strong>L</strong>  : 表示Last，最后一个；在日期那里表示一个月的最后一天；在星期那里表示一周的最后一天；<strong>“6L”</strong>表示这个月的倒数第６天</p>
<p><strong>W</strong>  : workday；表示为最近工作日，如<strong>“15W”</strong>放在每月（day-of-month）字段上表示为“到本月15日最近的工作日”</p>
<p><strong>#</strong>  : 是用来指定每月第n个星期几，例如在每周（day-of-week）这个字段中内容为<strong>”6#3” </strong>or <strong>“FRI#3”</strong> 则表示<strong>“每月第三个星期五”</strong></p>
<p><strong>示例：</strong></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505170400.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505170400.png"></p>
<blockquote>
<p>默认只有一个线程执行@Scheduled任务</p>
</blockquote>
<p>配置多个线程执行：</p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505170500.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505170500.png"></p>
<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><ul>
<li><p>@EnableCaching 启用缓存（@SpringBootApplication类或@Configuration类）</p>
</li>
<li><p>@Cacheable：声明方法可缓存。查询缓存中是否有值，有则直接取用；没有则执行相应的操作，并且会将结果保存到缓存中</p>
</li>
<li>@CacheEvict：删除。额外的参数allEntries表示是否需要清除缓存中的所有元素，默认为false，表示不需要；当指定了allEntries为true时，Spring Cache将忽略指定的key。</li>
<li>@CachePut：更新</li>
<li>@CacheConfig：有时候一个类中可能会有多个缓存操作，而这些缓存操作可能是重复的。这个时候可以使用@CacheConfig。它是类级别的注解，允许共享缓存的名称、KeyGenerator、CacheManager 和CacheResolver。该操作会被覆盖。</li>
</ul>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505172300.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505172300.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505172100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505172100.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505172200.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505172200.png"></p>
<h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505173400.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505173400.png"></p>
<p>默认即<strong>“cacheName::key”</strong></p>
<h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505173500.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505173500.png"></p>
<h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505173600.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505173600.png"></p>
<h3 id="设置过期"><a href="#设置过期" class="headerlink" title="设置过期"></a>设置过期</h3><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505173700.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505173700.png"></p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505200900.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505200900.png"></p>
<h1 id="Autowired加载规则"><a href="#Autowired加载规则" class="headerlink" title="@Autowired加载规则"></a>@Autowired加载规则</h1><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505210800.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505210800.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505211500.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505211500.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505211600.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505211600.png"></p>
<h1 id="定制Spring-Rest的错误返回信息"><a href="#定制Spring-Rest的错误返回信息" class="headerlink" title="定制Spring Rest的错误返回信息"></a>定制Spring Rest的错误返回信息</h1><p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505213100.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505213100.png"></p>
<p><img src="http://upyun.nidhogg.cn/img/SpringBootRest20190505213200.png" alt="http://upyun.nidhogg.cn/img/SpringBootRest20190505213200.png"></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2019/05/06/使用Python装饰器简化Django请求处理代码/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2019/04/27/Vue去掉路径#号及部署后刷新404问题/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.gif" alt="Zhu Yuexin's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        yuexinzh@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: yuexinzh@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2023/04/">April 2023<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/12/">December 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/11/">November 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/07/">July 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">May 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">April 2019<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">December 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/11/">November 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">July 2018<span class="sidebar_archives-count">23</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">June 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">April 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">March 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">January 2018<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">August 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">6</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android/">Android<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Android碎片/">Android碎片<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/categories/Android错误解决/">Android错误解决<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/C/">C#<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/Django/">Django<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Git/">Git<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Hexo/">Hexo<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java/">Java<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java笔记/">Java笔记<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Linux/">Linux<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Maven/">Maven<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/MySQL/">MySQL<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/Node/">Node<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/Shell/">Shell<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/SpringBoot/">SpringBoot<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Ubuntu/">Ubuntu<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/Vue/">Vue<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/WPF/">WPF<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/剑指Offer编程题/">剑指Offer编程题<span class="sidebar_archives-count">22</span></a></li><li><a class="sidebar_archives-link" href="/categories/小技能/">小技能<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/数据结构与算法/">数据结构与算法<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/机器学习/">机器学习<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/杂记/">杂记<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/游戏/">游戏<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/皮皮夏/">皮皮夏<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/皮皮夏的奇葩日记/">皮皮夏的奇葩日记<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/论文笔记/">论文笔记<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">sort</i>
                
                Tags
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="Timeline">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                Timeline
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                Links
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">97</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Theme - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>我的个人生活记录
            <a href="beian.miit.gov.cn">渝ICP备17003944号</a>
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
